<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ filename }}">
    <meta name="twitter:description" content="ä¸Šä¼ äºç§æœ‰äº‘å›¾åºŠ (Image URL Tool)">
    <meta name="twitter:image" content="{{ raw_url }}">

    <!-- Open Graph data -->
    <meta property="og:title" content="{{ filename }}" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="{{ page_url }}" />
    <meta property="og:image" content="{{ raw_url }}" />
    <meta property="og:description" content="ä¸Šä¼ äºç§æœ‰äº‘å›¾åºŠ (Image URL Tool)" />

    <title>{{ filename }} - ç§æœ‰äº‘å›¾åºŠ</title>
    <style>
        :root {
            --primary-color: #007bff;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-color: #e1e4e8;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background: var(--card-bg);
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
        }

        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        /* å¹¿å‘Šä½æ ·å¼ - å ä½ç¬¦ */
        .ad-slot {
            width: 100%;
            max-width: 728px;
            height: 90px;
            background-color: #e9ecef;
            border: 1px dashed #cbd5e0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            margin: 20px 0;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }

        .image-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            max-width: 100%;
            width: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }

        .image-preview {
            max-width: 100%;
            max-height: 70vh;
            /* é™åˆ¶é«˜åº¦ï¼Œç¡®ä¿ä¸æŠŠå¹¿å‘ŠæŒ¤æ²¡äº† */
            border-radius: 4px;
            object-fit: contain;
            cursor: zoom-in;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .action-bar {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            font-weight: 500;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: #e9ecef;
            color: #495057;
        }

        .btn-secondary:hover {
            background-color: #dee2e6;
        }

        .btn-icon {
            margin-right: 5px;
        }

        .info-bar {
            margin-top: 15px;
            color: #6c757d;
            font-size: 12px;
            text-align: center;
            display: flex;
            gap: 15px;
        }

        .count-down-tip {
            margin-top: 15px;
            font-size: 15px;
            color: var(--primary-color);
            font-weight: bold;
            background: #e7f5ff;
            padding: 8px 16px;
            border-radius: 20px;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;
            }

            .ad-slot {
                height: 100px;
                max-width: 100%;
            }

            .main-container {
                padding: 10px;
            }

            .image-card {
                padding: 10px;
                width: 100%;
            }
        }
    </style>
</head>

<body>

    <header class="header">
        <a href="/" class="logo">â˜ï¸ ç§æœ‰äº‘å›¾åºŠ</a>
        <a href="/" class="btn btn-secondary" style="font-size: 12px; padding: 6px 12px;">æˆ‘ä¹Ÿè¦ä¸Šä¼ </a>
    </header>

    <div class="main-container">

        <!-- TOP AD (728x90) -->
        <div class="ad-slot" id="ad-top">
            <div>
                <strong>ğŸ“¢ å¹¿å‘Šä½æ‹›ç§Ÿ</strong><br>
                <span style="font-size:12px; opacity:0.7">è”ç³»ç«™é•¿æŠ•æ”¾: me@example.com</span>
            </div>
            <!-- å¤‡æ¡ˆåæ›¿æ¢ä¸ºè”ç›Ÿä»£ç  -->
        </div>

        <div class="image-card">
            <a href="{{ raw_url }}" target="_blank">
                <img src="{{ raw_url }}" alt="{{ filename }}" class="image-preview" onclick="window.open(this.src)">
            </a>

            <div class="info-bar">
                <span>ğŸ“ {{ width }} x {{ height }}</span>
                <span>ğŸ’¾ {{ size_str }}</span>
                <span>ğŸ“… {{ created_at }}</span>
            </div>

            <div class="count-down-tip" id="countdown">
                â³ æ­£åœ¨åŠ è½½åŸå›¾é“¾æ¥ (3s)...
            </div>

            <div class="action-bar">
                <a href="{{ raw_url }}" class="btn btn-primary" id="viewRawBtn"
                    style="display:none; pointer-events: none; opacity: 0.6;" download="{{ filename }}">
                    <span class="btn-icon">â¬‡ï¸</span> ä¸‹è½½ / æŸ¥çœ‹åŸå›¾
                </a>
                <button class="btn btn-secondary" onclick="sharePage()">
                    <span class="btn-icon">ğŸ”—</span> åˆ†äº«æ­¤é¡µé¢
                </button>
                <button class="btn btn-secondary" onclick="openReportModal()" style="color: #d32f2f;">
                    <span class="btn-icon">ğŸš¨</span> ä¸¾æŠ¥æ­¤å›¾ç‰‡
                </button>
            </div>
        </div>

        <!-- BOTTOM AD (728x90) -->
        <div class="ad-slot" id="ad-bottom">
            <div>
                <strong>å…¬ç›Šå¹¿å‘Š:å®è´å›å®¶</strong><br>
                <span style="font-size:12px; opacity:0.7">å¸®åŠ©èµ°å¤±å„¿ç«¥å›å®¶ (æ­¤å¤„ä¸ºæ¨¡æ‹Ÿå¹¿å‘Šä½)</span>
            </div>
        </div>

    </div>

    <!-- ä¸¾æŠ¥æ¨¡æ€æ¡† -->
    <div id="reportModal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
        <div
            style="background:white; padding:25px; border-radius:12px; max-width:400px; width:90%; box-shadow:0 10px 30px rgba(0,0,0,0.2);">
            <h3 style="margin-top:0; color:#d32f2f;">ğŸš¨ ä¸¾æŠ¥æ­¤å›¾ç‰‡</h3>
            <p style="color:#666; font-size:14px;">å¦‚æœæ‚¨è®¤ä¸ºæ­¤å›¾ç‰‡è¿åäº†æ³•å¾‹æ³•è§„æˆ–æœåŠ¡æ¡æ¬¾ï¼Œè¯·è¯´æ˜åŸå› ã€‚</p>

            <div style="margin-bottom:15px;">
                <label style="display:block; margin-bottom:5px; font-weight:bold;">ä¸¾æŠ¥åŸå›  *</label>
                <textarea id="reportReason" rows="4"
                    style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; resize:vertical; box-sizing:border-box;"
                    placeholder="è¯·è¯¦ç»†æè¿°é—®é¢˜ï¼Œå¦‚ï¼šä¾µçŠ¯ç‰ˆæƒã€è‰²æƒ…å†…å®¹ã€è¿æ³•ä¿¡æ¯ç­‰"></textarea>
            </div>

            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:5px; font-weight:bold;">è”ç³»æ–¹å¼ (å¯é€‰)</label>
                <input type="text" id="reportContact"
                    style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; box-sizing:border-box;"
                    placeholder="é‚®ç®±æˆ–å…¶ä»–è”ç³»æ–¹å¼ï¼Œæ–¹ä¾¿æˆ‘ä»¬å›å¤æ‚¨">
            </div>

            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button onclick="closeReportModal()" class="btn btn-secondary">å–æ¶ˆ</button>
                <button onclick="submitReport()" class="btn btn-primary" style="background:#d32f2f;">æäº¤ä¸¾æŠ¥</button>
            </div>
        </div>
    </div>

    <footer style="margin-top:auto; padding:20px; text-align:center; color:#adb5bd; font-size:12px;">
        &copy; 2025 Image URL Tool. All rights reserved.
    </footer>

    <script>
        // å€’è®¡æ—¶é€»è¾‘
        let timeLeft = 3;
        const countdownEl = document.getElementById('countdown');
        const viewRawBtn = document.getElementById('viewRawBtn');

        // é¢„åŠ è½½å›¾ç‰‡ä»¥ç¡®ä¿æ˜¾ç¤º
        const img = new Image();
        img.src = "{{ raw_url }}";

        const timer = setInterval(() => {
            timeLeft--;
            if (timeLeft > 0) {
                countdownEl.innerText = `â³ æ­£åœ¨åŠ è½½åŸå›¾é“¾æ¥ (${timeLeft}s)...`;
            } else {
                clearInterval(timer);
                countdownEl.style.display = 'none';
                viewRawBtn.style.display = 'inline-flex';
                viewRawBtn.style.pointerEvents = 'auto';
                viewRawBtn.style.opacity = '1';
                // viewRawBtn.innerText = 'â¬‡ï¸ ä¸‹è½½ / æŸ¥çœ‹åŸå›¾'; 
            }
        }, 1000);

        function sharePage() {
            if (navigator.share) {
                navigator.share({
                    title: '{{ filename }}',
                    text: 'æ¥çœ‹çœ‹è¿™å¼ å›¾ç‰‡',
                    url: window.location.href,
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                showToast('âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.innerText = message;
            toast.style.position = 'fixed';
            toast.style.bottom = '20px';
            toast.style.left = '50%';
            toast.style.transform = 'translateX(-50%)';
            toast.style.background = 'rgba(0,0,0,0.8)';
            toast.style.color = 'white';
            toast.style.padding = '10px 20px';
            toast.style.borderRadius = '5px';
            toast.style.zIndex = '1001';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        // ä¸¾æŠ¥åŠŸèƒ½
        function openReportModal() {
            document.getElementById('reportModal').style.display = 'flex';
        }

        function closeReportModal() {
            document.getElementById('reportModal').style.display = 'none';
            document.getElementById('reportReason').value = '';
            document.getElementById('reportContact').value = '';
        }

        async function submitReport() {
            const reason = document.getElementById('reportReason').value.trim();
            const contact = document.getElementById('reportContact').value.trim();

            if (!reason) {
                alert('è¯·å¡«å†™ä¸¾æŠ¥åŸå› ');
                return;
            }

            // ä» URL æå– hash
            const pathParts = window.location.pathname.split('/');
            const imageHash = pathParts[pathParts.length - 1];

            try {
                const res = await fetch('/api/report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        image_hash: imageHash,
                        image_url: window.location.href,
                        reason: reason,
                        contact: contact || null
                    })
                });

                const data = await res.json();

                if (res.ok) {
                    closeReportModal();
                    showToast('âœ… æ„Ÿè°¢æ‚¨çš„ä¸¾æŠ¥ï¼Œæˆ‘ä»¬ä¼šå°½å¿«å¤„ç†');
                } else {
                    alert(data.detail || 'ä¸¾æŠ¥æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            } catch (e) {
                console.error(e);
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
    </script>
</body>

</html>