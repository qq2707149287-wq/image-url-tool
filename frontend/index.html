<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片URL获取工具</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>图片URL获取工具</h1>
            <p class="subtitle">多图床自动切换 · 永久存储 · 批量处理</p>
            <div class="header-tools">
                <button class="btn-ghost" id="themeToggle">🌙 深色模式</button>
            </div>
        </div>
        
        <!-- 导航栏 -->
        <div class="tabs">
            <button class="tab active" id="tab-upload">批量上传</button>
            <button class="tab" id="tab-paste">粘贴上传</button>
            <button class="tab" id="tab-history">历史记录</button>
        </div>
        
        <!-- ========================================= -->
        <!--              1. 批量上传页                -->
        <!-- ========================================= -->
        <div id="content-upload" class="tab-content active">
            <div id="uploadArea" class="upload-area">
                <p>点击或拖拽多张图片到这里</p>
                <p class="hint">支持 JPG / PNG / GIF / WebP (自动去重)</p>
            </div>

            <!-- 核心功能区：图床选择 -->
            <div class="service-selector" id="uploadServiceSelector">
                <p class="selector-title">选择图床 (支持多选/自动切换):</p>
                <div class="checkbox-group">
                    <!-- 自建图床 -->
                    <label><input type="checkbox" value="myminio" checked> MyCloud <span class="tag-hot" style="background:#e0f2fe; color:#0284c7; border-color:#bae6fd;">自建</span></label>
                    
                    <!-- 公共图床 -->
                    <label><input type="checkbox" value="imgbb" checked> ImgBB <span class="tag-hot">稳</span></label>
                    <label><input type="checkbox" value="catbox" checked> Catbox <span class="tag-hot">推</span></label>
                    <label><input type="checkbox" value="imagekit"> ImageKit</label>
                    <label><input type="checkbox" value="uguu"> Uguu</label>
                    <label><input type="checkbox" value="pomf"> Pomf</label>
                    <label><input type="checkbox" value="0x0"> 0x0</label>
                </div>
            </div>

            <!-- 核心功能区：压缩与格式 (完全找回) -->
            <div class="compress-options">
                <label>压缩等级: 
                    <input type="radio" name="compressMode" value="none" checked> 原图
                    <input type="radio" name="compressMode" value="medium"> 中等
                    <input type="radio" name="compressMode" value="high"> 强力
                </label>
                <label style="margin-left: 20px;">转换格式: 
                    <select id="outputFormatSelect">
                        <option value="auto">保持原样</option>
                        <option value="jpeg">转 JPEG</option>
                        <option value="png">转 PNG</option>
                        <option value="webp">转 WebP</option>
                    </select>
                </label>
            </div>

            <input type="file" id="fileInput" accept="image/*" multiple hidden>
            
            <!-- 新功能：批量上传进度列表 -->
            <div id="uploadBatchList" class="batch-list"></div>

            <!-- 旧功能保留：单张/最后一张的大结果展示框 -->
            <div id="uploadResult" class="result-box" style="display:none; margin-top: 20px;">
                <h3>最新上传结果</h3>
                <span id="uploadServiceBadge" class="service-badge"></span>
                
                <div class="url-box">
                    <a id="uploadResultUrl" target="_blank" href="#"></a>
                </div>
                
                <div class="action-buttons" style="margin-top: 10px; display:flex; gap:10px;">
                    <button class="copy-btn" id="uploadCopyBtn">复制链接</button>
                    <button class="copy-btn" id="uploadQrBtn">二维码</button>
                    <button class="copy-btn" id="uploadOpenBtn">打开图片</button>
                </div>

                <div id="uploadImageInfo" class="info-grid" style="margin-top: 15px;">
                    <!-- JS会自动填充尺寸信息 -->
                </div>
            </div>
        </div>
        
        <!-- ========================================= -->
        <!--              2. 粘贴上传页                -->
        <!-- ========================================= -->
        <div id="content-paste" class="tab-content">
            <div id="pasteArea" class="paste-area" tabindex="0">
                <p>Ctrl + V 在此处粘贴图片</p>
            </div>

            <div class="service-selector" id="pasteServiceSelector">
                <p class="selector-title">上传到:</p>
                <div class="checkbox-group">
                    <label><input type="checkbox" value="myminio" checked> MyCloud</label>
                    <label><input type="checkbox" value="catbox" checked> Catbox</label>
                    <label><input type="checkbox" value="imgbb"> ImgBB</label>
                </div>
            </div>

            <img id="pastePreview" class="preview-img">
            
            <div id="pasteLoading" class="loading" style="display:none;">
                <div class="spinner"></div>
                <p>正在处理并上传...</p>
            </div>

            <div id="pasteResult" class="result-box">
                <h3>上传成功</h3>
                <span id="pasteServiceBadge" class="service-badge"></span>
                <div class="url-box"><a id="pasteResultUrl" target="_blank"></a></div>
                <div class="action-buttons">
                    <button class="copy-btn" id="pasteCopyBtn">复制</button>
                    <button class="copy-btn" id="pasteQrBtn">二维码</button>
                    <button class="copy-btn" id="pasteOpenBtn">打开</button>
                </div>
                <div id="pasteImageInfo" class="info-grid"></div>
            </div>
        </div>
        
        <!-- ========================================= -->
        <!--              3. 历史记录页                -->
        <!-- ========================================= -->
        <div id="content-history" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h3>历史记录</h3>
                <div class="history-tools">
                    <!-- 导入导出功能完全保留 -->
                     <button class="btn-ghost" id="exportJsonBtn">导出备份</button>
                     <input type="file" id="importFileInput" hidden>
                     <button class="btn-ghost" id="importJsonBtn">导入备份</button>
                     <button class="btn-ghost" id="clearHistoryBtn" style="color:var(--danger)">清空全部</button>
                </div>
            </div>
            
            <div class="history-filters">
                <input type="text" id="historySearch" placeholder="搜索文件名或链接...">
            </div>
            
            <div id="historyList"></div>
        </div>
    </div>

    <!-- 全局组件 -->
    <div id="toast-container" class="toast-container"></div>
    
    <!-- 第三方库 -->
    <script src="https://cdn.staticfile.org/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- 本地逻辑 -->
    <script src="/static/js/ui.js" defer></script>
    <script src="/static/js/core.js" defer></script>
    <script src="/static/js/upload.js" defer></script>
    <script src="/static/js/paste.js" defer></script>
    <script src="/static/js/history.js" defer></script>
    <script src="/static/js/qr.js" defer></script>
</body>
</html>