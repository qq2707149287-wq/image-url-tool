<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片URL获取工具</title>
    <!-- 这里保留了 static/，因为你以前用它好使，说明后端配了映射 -->
    <link rel="stylesheet" href="static/style.css">
    
    <!-- 这里的 JS 引用也都加回了 static/ -->
    <script src="static/js/core.js"></script>
    <script src="static/js/ui.js"></script>
    <script src="static/js/upload.js"></script>
    <script src="static/js/paste.js"></script>
    <script src="static/js/history.js"></script>
    <script src="static/js/link_check.js"></script>
    <script src="static/js/qr.js"></script>
    
    <!-- 🔥 重点修复：这里换成了在线链接，用来解决找不到 lib/qrcode.min.js 的问题 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body data-theme="light">
    <div class="container">
        <!-- 顶部标题栏 -->
        <header>
            <div class="header-left">
                <h1>🖼️ 图片URL工具</h1>
                <span class="version-tag">v2.1 Pro</span>
            </div>
            <div class="header-right">
                <select id="copyFormatSelect" onchange="updateCopyFormat(this.value)" class="format-select">
                    <option value="url">纯URL</option>
                    <option value="markdown">Markdown</option>
                    <option value="html">HTML</option>
                    <option value="bbcode">BBCode</option>
                </select>
                <button onclick="toggleTheme()" class="icon-btn" title="切换主题">🌓</button>
            </div>
        </header>

        <!-- 选项卡导航 -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('upload')">📤 本地上传</button>
            <button class="tab-btn" onclick="switchTab('paste')">📋 粘贴验证</button>
            <button class="tab-btn" onclick="switchTab('history')">📜 历史记录</button>
        </div>

        <!-- 内容区域 -->
        <div class="tab-content">
            
            <!-- 1. 上传面板 -->
            <div id="tab-upload" class="tab-pane active">
                <div class="upload-options">
                    <div class="option-row">
                        <label>选择图床 (支持多选/自动切换):</label>
                        <div id="uploadServiceSelector" class="service-checks">
                            <label><input type="checkbox" value="myminio" checked> MyCloud <span class="tag-blue">自建</span></label>
                            <label><input type="checkbox" value="imgbb" checked> ImgBB <span class="tag-pink">稳</span></label>
                        </div>
                    </div>
                </div>

                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">☁️</div>
                    <p>拖拽图片到这里，或点击选择</p>
                    <p class="sub-text">支持 JPG, PNG, GIF, WEBP (最大 32MB)</p>
                    <input type="file" id="fileInput" multiple accept="image/*" hidden>
                </div>

                <!-- 上传结果列表 -->
                <div id="uploadBatchList" class="batch-list"></div>

                <!-- 上传分页控制条 -->
                <div id="uploadPagination" class="pagination-bar" style="display:none; justify-content: space-between; align-items: center; margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                    <div class="page-size-selector">
                        <label>每页:</label>
                        <select onchange="window.changeUploadPageSize(this.value)" style="padding: 2px 5px;">
                            <option value="5">5条</option>
                            <option value="10">10条</option>
                            <option value="20">20条</option>
                        </select>
                    </div>
                    <div class="page-controls">
                        <button onclick="window.prevUploadPage()" class="btn-mini">上一页</button>
                        <span id="uploadPageInfo" style="margin: 0 10px; font-weight: bold;">1/1</span>
                        <button onclick="window.nextUploadPage()" class="btn-mini">下一页</button>
                    </div>
                </div>
            </div>

            <!-- 2. 粘贴面板 -->
            <div id="tab-paste" class="tab-pane">
                <div class="paste-area" id="pasteBox" contenteditable="true">
                    <p>点击此处，按 Ctrl+V 粘贴图片或 URL...</p>
                </div>
                <div id="pastePreview" class="paste-result"></div>
            </div>

            <!-- 3. 历史面板 -->
            <div id="tab-history" class="tab-pane">
                <div class="history-tools">
                    <input type="text" id="searchInput" placeholder="🔍 搜索文件名或URL..." onkeyup="filterHistory()">
                    <div class="history-btns">
                        <button onclick="exportHistory()" class="btn-small">导出</button>
                        <button onclick="document.getElementById('importFile').click()" class="btn-small">导入</button>
                        <button onclick="window.clearHistory ? window.clearHistory() : alert('JS未加载')" class="btn-small btn-danger">清空</button>
                        <input type="file" id="importFile" hidden onchange="importHistory(this)">
                    </div>
                </div>
                
                <div id="historyList" class="history-list"></div>

                <!-- 历史分页控制条 -->
                <div id="historyPagination" class="pagination-bar" style="display:none; justify-content: space-between; align-items: center; margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                    <div class="page-size-selector">
                        <label>每页:</label>
                        <select onchange="window.changeHistoryPageSize(this.value)" style="padding: 2px 5px;">
                            <option value="5" selected>5条</option>
                            <option value="10">10条</option>
                            <option value="20">20条</option>
                            <option value="50">50条</option>
                        </select>
                    </div>
                    <div class="page-controls">
                        <button onclick="window.prevHistoryPage()" class="btn-mini">上一页</button>
                        <span id="historyPageInfo" style="margin: 0 10px; font-weight: bold;">1/1</span>
                        <button onclick="window.nextHistoryPage()" class="btn-mini">下一页</button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</body>
</html>