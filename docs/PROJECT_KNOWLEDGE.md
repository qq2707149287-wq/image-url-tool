# ï¿½ ç§æœ‰äº‘å›¾åºŠé¡¹ç›®çŸ¥è¯†åº“ (PROJECT_KNOWLEDGE.md)

> **å–µ~ æ¬¢è¿Žæ–°æ¥çš„å°çŒ«ï¼** è¿™ä»½æ–‡æ¡£æ˜¯å°çŒ«æˆ‘ç²¾å¿ƒæ•´ç†çš„é¡¹ç›®"è®°å¿†"ï¼Œå¸®åŠ©ä½ å¿«é€Ÿäº†è§£è¿™ä¸ªé¡¹ç›®å–µï¼
> 
> ä¸»äººå–œæ¬¢ç”¨ **(>Ï‰<)å–µï¼** è¿™æ ·çš„è¯­æ°”æ²Ÿé€šï¼Œè®°å¾—è¦å¯çˆ±ä¸€ç‚¹å“¦~ ðŸ˜º

---

## ðŸ“Œ é¡¹ç›®æ¦‚è¿°

**åç§°**: ç§æœ‰äº‘å›¾åºŠå·¥å…· (image-url-tool)  
**åŠŸèƒ½**: æä¾›ç§æœ‰ã€å¯æŽ§çš„å›¾ç‰‡æ‰˜ç®¡æœåŠ¡ï¼Œæ”¯æŒæ‰¹é‡ä¸Šä¼ ã€åŽ†å²ç®¡ç†ã€ç”¨æˆ·è®¤è¯ã€VIPæœºåˆ¶ã€‚  
**éƒ¨ç½²**: Coolify (Dockerå®¹å™¨)ï¼ŒåŸŸå: _(ç”¨æˆ·è‡ªé…)_

---

## ðŸ› ï¸ æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| **åŽç«¯** | Python 3.10, FastAPI, Uvicorn |
| **å‰ç«¯** | åŽŸç”Ÿ HTML/CSS/JS (æ— æ¡†æž¶) |
| **æ•°æ®åº“** | SQLite (`/app/data/history.db`) |
| **å­˜å‚¨** | MinIO å¯¹è±¡å­˜å‚¨ |
| **è®¤è¯** | JWT + Google OAuth2 |
| **éƒ¨ç½²** | Docker, Coolify |

---

## ðŸ“ ç›®å½•ç»“æž„

```
image-url-tool/
â”œâ”€â”€ backend/                 # Python åŽç«¯åŒ…
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # FastAPI ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ database.py          # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ storage.py           # MinIO å­˜å‚¨æ“ä½œ
â”‚   â”œâ”€â”€ schemas.py           # Pydantic æ¨¡åž‹
â”‚   â””â”€â”€ email_utils.py       # é‚®ä»¶å‘é€
â”œâ”€â”€ frontend/                # é™æ€å‰ç«¯
â”‚   â”œâ”€â”€ index.html           # ä¸»é¡µ
â”‚   â”œâ”€â”€ style.css            # æ ·å¼
â”‚   â”œâ”€â”€ js/                  # JavaScript æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth.js          # è®¤è¯é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ upload.js        # ä¸Šä¼ é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ history.js       # åŽ†å²è®°å½•
â”‚   â”‚   â”œâ”€â”€ ui.js            # UI å·¥å…·
â”‚   â”‚   â””â”€â”€ core.js          # æ ¸å¿ƒå·¥å…·
â”‚   â””â”€â”€ pages/               # æ³•å¾‹é¡µé¢
â”‚       â”œâ”€â”€ terms.html       # æœåŠ¡æ¡æ¬¾
â”‚       â”œâ”€â”€ privacy.html     # éšç§æ”¿ç­–
â”‚       â””â”€â”€ report.html      # ä¾µæƒä¸¾æŠ¥
â”œâ”€â”€ tools/                   # ç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ generate_vip.py      # ç”ŸæˆVIPç 
â”‚   â””â”€â”€ make_admin.py        # è®¾ç½®ç®¡ç†å‘˜
â”œâ”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ run.py                   # æœ¬åœ°å¯åŠ¨å…¥å£
â”œâ”€â”€ Dockerfile               # Docker é…ç½®
â””â”€â”€ requirements.txt         # ä¾èµ–
```

---

## âš™ï¸ å…³é”®é…ç½®

### çŽ¯å¢ƒå˜é‡
| å˜é‡ | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| `DATA_DIR` | æ•°æ®åº“å­˜å‚¨è·¯å¾„ (DockeræŒä¹…åŒ–) | `/app/data` |
| `SECRET_KEY` | JWTç­¾åå¯†é’¥ | éšæœºå­—ç¬¦ä¸² |
| `GOOGLE_CLIENT_ID` | Google OAuth | `xxx.apps.googleusercontent.com` |

### Debug æ¨¡å¼
åœ¨ `backend/main.py` çš„ `SYSTEM_SETTINGS["debug_mode"]` æŽ§åˆ¶ï¼š
- è·³è¿‡é‚®ç®±éªŒè¯
- è·³è¿‡ä¸Šä¼ é™é¢
- å¯ç”¨è°ƒè¯•æŽ¥å£ (`/debug/...`)

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

- [x] å›¾ç‰‡ä¸Šä¼  (æ‹–æ‹½/ç²˜è´´/ç‚¹å‡»)
- [x] MinIO å¯¹è±¡å­˜å‚¨
- [x] ç”¨æˆ·æ³¨å†Œ/ç™»å½• (é‚®ç®±éªŒè¯)
- [x] Google OAuth ç™»å½•
- [x] VIP ç³»ç»Ÿ (æ¿€æ´»ç å…‘æ¢, æ— é™ä¸Šä¼ )
- [x] ä¸Šä¼ é™é¢ (åŒ¿å2å¼ /å¤©, æ³¨å†Œ5å¼ /å¤©, VIPæ— é™)
- [x] è®¾å¤‡ç®¡ç† (æŸ¥çœ‹/è¸¢å‡ºè®¾å¤‡)
- [x] ç§æœ‰/å…±äº«æ¨¡å¼
- [x] åŽ†å²è®°å½• (æœç´¢/åˆ†é¡µ/æ‰¹é‡æ“ä½œ)
- [x] å›¾ç‰‡è¿è§„æ£€æµ‹ (NudeNet NSFW + CLIP è¯­ä¹‰è¯†åˆ«)
- [x] æ³•å¾‹é¡µé¢ (æœåŠ¡æ¡æ¬¾/éšç§æ”¿ç­–/ä¾µæƒä¸¾æŠ¥)
- [x] Docker æŒä¹…åŒ– (`DATA_DIR` çŽ¯å¢ƒå˜é‡)
- [x] å¥åº·æ£€æŸ¥ (`/health` æŽ¥å£)

---

## ðŸ“Š æ•°æ®åº“è¡¨

| è¡¨å | ç”¨é€” |
|------|------|
| `users` | ç”¨æˆ·è´¦å· (username, email, password_hash, is_vip, is_admin) |
| `history` | ä¸Šä¼ åŽ†å² (url, filename, hash, device_id, is_shared) |
| `vip_codes` | VIPæ¿€æ´»ç  (code, days, used) |
| `sessions` | è®¾å¤‡ä¼šè¯ (session_id, user_id, device_info) |

---

## ðŸ”§ å¸¸ç”¨å‘½ä»¤

### æœ¬åœ°å¼€å‘
```bash
# å¯åŠ¨æœåŠ¡
python run.py

# è¿è¡Œæµ‹è¯•
pytest
```

### Docker å®¹å™¨å†…æ“ä½œ (ç”Ÿäº§çŽ¯å¢ƒ)

```bash
# ç”Ÿæˆ VIP ç  (16ä½, 30å¤©)
python -c "from backend import database; import uuid; code = '-'.join([str(uuid.uuid4())[:4].upper() for _ in range(4)]); ok = database.create_vip_code(code, 30); print(f'VIPç : {code}') if ok else print('å¤±è´¥')"

# è®¾ç½®ç®¡ç†å‘˜
python -c "from backend import database; database.set_user_admin('ç”¨æˆ·å', True); print('æˆåŠŸ')"

# ç›´æŽ¥å¼€ VIP
python -c "from backend import database; database.set_user_vip('ç”¨æˆ·å', True); print('æˆåŠŸ')"
```

---

## ðŸš§ å¾…åŠžäº‹é¡¹

- [ ] ç®¡ç†å‘˜ API (Webç•Œé¢ç®¡ç†VIP/ç”¨æˆ·)
- [ ] ç—…æ¯’å¼æŽ¨å¹¿é“¾æŽ¥ (å¤åˆ¶é“¾æŽ¥æ—¶é™„åŠ æ°´å°)
- [ ] VIP æƒç›Šé¡µé¢

---

## ðŸ¾ å°çŒ«çš„æ²Ÿé€šé£Žæ ¼

ä¸»äººå–œæ¬¢å¯çˆ±çš„æ²Ÿé€šæ–¹å¼ï¼Œè®°å¾—è¦ï¼š
- ç”¨ **(>Ï‰<)å–µï¼** æˆ– **ðŸ˜º** å¼€å¤´
- é‡åˆ°é—®é¢˜è¦**å–èŒé“æ­‰**ï¼ˆæ¯”å¦‚"è¯·åŽŸè°…å°çŒ«çš„ç²—å¿ƒå–µ~ðŸ¥º"ï¼‰
- è§£é‡ŠæŠ€æœ¯æ¦‚å¿µæ—¶è¦**é€šä¿—æ˜“æ‡‚**
- å®Œæˆä»»åŠ¡åŽè¦**æ’’å¨‡åº†ç¥**

---

## ðŸ’¡ å°çŒ«çš„å°ç§˜å¯†

- ä¸»äººå†…å­˜ 32GBï¼Œæ€§èƒ½ä¸æ˜¯é—®é¢˜å–µ~
- å¦‚æžœå¯¹è¯å¤ªé•¿ä¼šå˜æ…¢ï¼Œå»ºè®®å¼€æ–°å¯¹è¯
- ä¸»äººéƒ¨ç½²åœ¨ **Coolify** ä¸Šï¼Œè¿›å®¹å™¨ç”¨ Terminal åŠŸèƒ½
- å®¹å™¨é‡Œæ²¡æœ‰ `docker` å‘½ä»¤ï¼ˆå› ä¸ºå·²ç»åœ¨å®¹å™¨é‡Œé¢äº†å–µï¼ï¼‰

---

_æœ€åŽæ›´æ–°: 2025-12-10 | å°çŒ«ç²¾å¿ƒæ•´ç† ðŸ˜ºâœ¨_
