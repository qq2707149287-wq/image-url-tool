# ğŸ—‚ï¸ ç§æœ‰äº‘å›¾åºŠé¡¹ç›®çŸ¥è¯†åº“ (PROJECT_KNOWLEDGE.md)

> **ç”¨é€”**: å¸®åŠ© AI åŠ©æ‰‹å¿«é€Ÿç†è§£é¡¹ç›®ä¸Šä¸‹æ–‡ã€‚æ–°å¯¹è¯å¼€å§‹æ—¶å¯ä»¥å…ˆé˜…è¯»æ­¤æ–‡ä»¶ã€‚

---

## ğŸ“Œ é¡¹ç›®æ¦‚è¿°

**åç§°**: ç§æœ‰äº‘å›¾åºŠå·¥å…· (image-url-tool)  
**åŠŸèƒ½**: æä¾›ç§æœ‰ã€å¯æ§çš„å›¾ç‰‡æ‰˜ç®¡æœåŠ¡ï¼Œæ”¯æŒæ‰¹é‡ä¸Šä¼ ã€å†å²ç®¡ç†ã€ç”¨æˆ·è®¤è¯ã€VIPæœºåˆ¶ã€‚  
**éƒ¨ç½²**: Coolify (Dockerå®¹å™¨)ï¼ŒåŸŸå: _(ç”¨æˆ·è‡ªé…)_

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| **åç«¯** | Python 3.10, FastAPI, Uvicorn |
| **å‰ç«¯** | åŸç”Ÿ HTML/CSS/JS (æ— æ¡†æ¶) |
| **æ•°æ®åº“** | SQLite (`/app/data/history.db`) |
| **å­˜å‚¨** | MinIO å¯¹è±¡å­˜å‚¨ |
| **è®¤è¯** | JWT + Google OAuth2 |
| **éƒ¨ç½²** | Docker, Coolify |

---

## ğŸ“ ç›®å½•ç»“æ„

```
image-url-tool/
â”œâ”€â”€ backend/                 # Python åç«¯åŒ…
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # FastAPI ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ database.py          # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ storage.py           # MinIO å­˜å‚¨æ“ä½œ
â”‚   â”œâ”€â”€ schemas.py           # Pydantic æ¨¡å‹
â”‚   â””â”€â”€ email_utils.py       # é‚®ä»¶å‘é€
â”œâ”€â”€ frontend/                # é™æ€å‰ç«¯
â”‚   â”œâ”€â”€ index.html           # ä¸»é¡µ
â”‚   â”œâ”€â”€ style.css            # æ ·å¼
â”‚   â”œâ”€â”€ js/                  # JavaScript æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth.js          # è®¤è¯é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ upload.js        # ä¸Šä¼ é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ history.js       # å†å²è®°å½•
â”‚   â”‚   â”œâ”€â”€ ui.js            # UI å·¥å…·
â”‚   â”‚   â””â”€â”€ core.js          # æ ¸å¿ƒå·¥å…·
â”‚   â””â”€â”€ pages/               # æ³•å¾‹é¡µé¢
â”‚       â”œâ”€â”€ terms.html       # æœåŠ¡æ¡æ¬¾
â”‚       â”œâ”€â”€ privacy.html     # éšç§æ”¿ç­–
â”‚       â””â”€â”€ report.html      # ä¾µæƒä¸¾æŠ¥
â”œâ”€â”€ tools/                   # ç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ generate_vip.py      # ç”ŸæˆVIPç 
â”‚   â””â”€â”€ make_admin.py        # è®¾ç½®ç®¡ç†å‘˜
â”œâ”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ run.py                   # æœ¬åœ°å¯åŠ¨å…¥å£
â”œâ”€â”€ Dockerfile               # Docker é…ç½®
â””â”€â”€ requirements.txt         # ä¾èµ–
```

---

## âš™ï¸ å…³é”®é…ç½®

### ç¯å¢ƒå˜é‡
| å˜é‡ | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| `DATA_DIR` | æ•°æ®åº“å­˜å‚¨è·¯å¾„ (DockeræŒä¹…åŒ–) | `/app/data` |
| `SECRET_KEY` | JWTç­¾åå¯†é’¥ | éšæœºå­—ç¬¦ä¸² |
| `GOOGLE_CLIENT_ID` | Google OAuth | `xxx.apps.googleusercontent.com` |

### Debug æ¨¡å¼
åœ¨ `backend/main.py` çš„ `SYSTEM_SETTINGS["debug_mode"]` æ§åˆ¶ï¼š
- è·³è¿‡é‚®ç®±éªŒè¯
- è·³è¿‡ä¸Šä¼ é™é¢
- å¯ç”¨è°ƒè¯•æ¥å£ (`/debug/...`)

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

- [x] å›¾ç‰‡ä¸Šä¼  (æ‹–æ‹½/ç²˜è´´/ç‚¹å‡»)
- [x] MinIO å¯¹è±¡å­˜å‚¨
- [x] ç”¨æˆ·æ³¨å†Œ/ç™»å½• (é‚®ç®±éªŒè¯)
- [x] Google OAuth ç™»å½•
- [x] VIP ç³»ç»Ÿ (æ¿€æ´»ç å…‘æ¢, æ— é™ä¸Šä¼ )
- [x] ä¸Šä¼ é™é¢ (åŒ¿å2å¼ /å¤©, æ³¨å†Œ5å¼ /å¤©, VIPæ— é™)
- [x] è®¾å¤‡ç®¡ç† (æŸ¥çœ‹/è¸¢å‡ºè®¾å¤‡)
- [x] ç§æœ‰/å…±äº«æ¨¡å¼
- [x] å†å²è®°å½• (æœç´¢/åˆ†é¡µ/æ‰¹é‡æ“ä½œ)
- [x] æ³•å¾‹é¡µé¢ (æœåŠ¡æ¡æ¬¾/éšç§æ”¿ç­–/ä¾µæƒä¸¾æŠ¥)
- [x] Docker æŒä¹…åŒ– (`DATA_DIR` ç¯å¢ƒå˜é‡)
- [x] å¥åº·æ£€æŸ¥ (`/health` æ¥å£)

---

## ğŸ“Š æ•°æ®åº“è¡¨

| è¡¨å | ç”¨é€” |
|------|------|
| `users` | ç”¨æˆ·è´¦å· (username, email, password_hash, is_vip, is_admin) |
| `history` | ä¸Šä¼ å†å² (url, filename, hash, device_id, is_shared) |
| `vip_codes` | VIPæ¿€æ´»ç  (code, days, used) |
| `sessions` | è®¾å¤‡ä¼šè¯ (session_id, user_id, device_info) |

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### æœ¬åœ°å¼€å‘
```bash
# å¯åŠ¨æœåŠ¡
python run.py

# è¿è¡Œæµ‹è¯•
pytest
```

### Docker å®¹å™¨å†…æ“ä½œ (ç”Ÿäº§ç¯å¢ƒ)

```bash
# ç”Ÿæˆ VIP ç  (16ä½, 30å¤©)
python -c "from backend import database; import uuid; code = '-'.join([str(uuid.uuid4())[:4].upper() for _ in range(4)]); ok = database.create_vip_code(code, 30); print(f'VIPç : {code}') if ok else print('å¤±è´¥')"

# è®¾ç½®ç®¡ç†å‘˜
python -c "from backend import database; database.set_user_admin('ç”¨æˆ·å', True); print('æˆåŠŸ')"

# ç›´æ¥å¼€ VIP
python -c "from backend import database; database.set_user_vip('ç”¨æˆ·å', True); print('æˆåŠŸ')"
```

---

## ğŸš§ å¾…åŠäº‹é¡¹

- [ ] ç®¡ç†å‘˜ API (Webç•Œé¢ç®¡ç†VIP/ç”¨æˆ·)
- [ ] å›¾ç‰‡è¿è§„æ£€æµ‹ (NSFW/æš´åŠ›å†…å®¹)
- [ ] ç—…æ¯’å¼æ¨å¹¿é“¾æ¥ (å¤åˆ¶é“¾æ¥æ—¶é™„åŠ æ°´å°)
- [ ] VIP æƒç›Šé¡µé¢

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®æŒä¹…åŒ–**: Docker å¿…é¡»æŒ‚è½½ `/app/data` å·ï¼Œå¦åˆ™é‡å¯åæ•°æ®ä¸¢å¤±ã€‚
2. **CSS ç¼“å­˜**: ä¿®æ”¹ `style.css` åéœ€æ›´æ–° `index.html` ä¸­çš„ç‰ˆæœ¬å· (`?v=1.x`)ã€‚
3. **æ¸…åé•œåƒ**: Dockerfile ä½¿ç”¨æ¸…åæºåŠ é€Ÿ apt/pipï¼Œé¿å…æ„å»ºè¶…æ—¶ã€‚

---

_æœ€åæ›´æ–°: 2025-12-10_
